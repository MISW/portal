name: Docker

on: [push]

jobs:
  frontend:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/actions/docker-build-action
        with:
          build_only: ${{ github.actor == 'dependabot[bot]' }}
          registry_username: ${{ secrets.DOCKER_USERNAME }}
          registry_password: ${{ secrets.DOCKER_PASSWORD }}
          name: frontend
          file: frontend.Dockerfile
          target: production

  backend:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - uses: ./.github/actions/docker-build-action
        with:
          build_only: ${{ github.actor == 'dependabot[bot]' }}
          registry_username: ${{ secrets.DOCKER_USERNAME }}
          registry_password: ${{ secrets.DOCKER_PASSWORD }}
          name: backend
          file: backend.Dockerfile
          target: production
